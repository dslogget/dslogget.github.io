<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>JUK1: D:/dslog/Documents/JUK1/C++/src/Matlab/QPpassive.m Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">JUK1
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_q_ppassive_8m_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">QPpassive.m</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_q_ppassive_8m.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="line" href="_q_ppassive_8m.html#aefa3a44886c8a1eaa39cf45cc918a59a">    1</a></span>&#160;<span class="keyword">function</span> [SERCsubnew,SERDnew]=...</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;          <a class="code" href="_q_ppassive_8m.html#a879d0e439ff91148c53bf3bf5e40d357">QPpassive</a>(bw,SERA,SERC,SERD,SERE,<a class="code" href="find_complex_rational_approximation_8m.html#ace5ae57a640fd6f3b4e6ed038aac371f">s</a>,weightflag,...</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;                    <a class="code" href="_q_ppassive_8m.html#aea4e41a0bec964966ccd0f3632106868">auxflag</a>,weightfactor,SERAsub,SERCsub,s2,s3,TOL);</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;%</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;%      ======================================================</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;%      =   Routine: <a class="code" href="_q_ppassive_8m.html#a879d0e439ff91148c53bf3bf5e40d357">QPpassive</a>.m                             = </div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;%      =   Version 1.2                                      =</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;%      =   Last revised: 11.04.2007                         = </div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;%      =   Bjorn Gustavsen                                  =</div>
<div class="line"><a name="l00010"></a><span class="lineno"><a class="line" href="_q_ppassive_8m.html#a879d0e439ff91148c53bf3bf5e40d357">   10</a></span>&#160;%      =   SINTEF Energy Research, N-7465 Trondheim, NORWAY =</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;%      =   bjorn.gustavsen@sintef.<a class="code" href="_q_ppassive_8m.html#a7d91f81694976146b3a75aadac28afa0">no</a>                        =</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;%      ======================================================</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;%</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;%<a class="code" href="_q_ppassive_8m.html#aefa3a44886c8a1eaa39cf45cc918a59a">function</a> [SERCsubnew,SERDnew]=...</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;%          <a class="code" href="_q_ppassive_8m.html#a879d0e439ff91148c53bf3bf5e40d357">QPpassive</a>(bw,SERA,SERC,SERD,SERE,<a class="code" href="find_complex_rational_approximation_8m.html#ace5ae57a640fd6f3b4e6ed038aac371f">s</a>,weightflag,...</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;%                    <a class="code" href="_q_ppassive_8m.html#aea4e41a0bec964966ccd0f3632106868">auxflag</a>,weightfactor,SERAsub,SERCsub,s2,s3,TOL);</div>
<div class="line"><a name="l00017"></a><span class="lineno"><a class="line" href="_q_ppassive_8m.html#ac9b1cacb1b40df6d9a76b99a9d1296c9">   17</a></span>&#160;%  </div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;%  PURPOSE : Modify <a class="code" href="_q_ppassive_8m.html#a712f8497424fce048b75fff1f16f2ebd">elements</a> in SERC and SERD of rational approximation </div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;%                  </div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;%                   N   SERCijm</div>
<div class="line"><a name="l00021"></a><span class="lineno"><a class="line" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">   21</a></span>&#160;%           Yij(<a class="code" href="find_complex_rational_approximation_8m.html#ace5ae57a640fd6f3b4e6ed038aac371f">s</a>)=SUM(---------  ) +SERDij +<a class="code" href="find_complex_rational_approximation_8m.html#ace5ae57a640fd6f3b4e6ed038aac371f">s</a>*SEREij (&quot;ij&quot; denotes element <a class="code" href="generate_p_r_r_file_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>,<a class="code" href="interch_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>)</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;%                  <a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>=1 (<a class="code" href="find_complex_rational_approximation_8m.html#ace5ae57a640fd6f3b4e6ed038aac371f">s</a>-SERAm)        </div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;%</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;%            to enforce passivity at given frequency samples. </div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;%</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;% =================================================</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;%     INPUT :</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;% =================================================</div>
<div class="line"><a name="l00029"></a><span class="lineno"><a class="line" href="_q_ppassive_8m.html#a4792de30be16d1aed1a1665418e67c9a">   29</a></span>&#160;%</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;%  bw  =0 --&gt; Will modify elements on the diagonal of Rm, D              |0  1  2  3| </div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;%      =1 --&gt; will modify elements on diagonal plus 1 band on each side  |1  0  1  2| </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;%      =2 --&gt; will modify elements on diagonal plus 2 bands on each side |2  1  0  1|</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;%      etc..                                                             |3  2  1  0|</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;% -----------------------------------------------------------------------------------                       </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;%  LEAST SQUARES PART:</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;%</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;%  SERA(N,1)     : Poles    </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;%  SERC(Nc,Nc,N) : Residues  </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;%  SERD(Nc,Nc)   : Constant term  </div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;%  SERE(Nc,Nc)   : Capacitive term     </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;%</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;%  s(1,Ns)       : Frequency samples (jw [rad/sec])</div>
<div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="_q_ppassive_8m.html#a09bb415406bbe2b23e379317002b1dba">   43</a></span>&#160;%  </div>
<div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="_q_ppassive_8m.html#a1d55f8bde712a83fc0abaddd0e76d831">   44</a></span>&#160;%  weightflag=1 --&gt; weight=1 for all elements in Least Squares problem, at all freq.</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;%            =2 --&gt; weight=1/sqrt(<a class="code" href="interch_8m.html#ae4e69912f5a2f923a187c235f950a7d2">abs</a>(Yijw)); indvidual element <a class="code" href="_q_ppassive_8m.html#a1d55f8bde712a83fc0abaddd0e76d831">weighting</a></div>
<div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="_q_ppassive_8m.html#a712f8497424fce048b75fff1f16f2ebd">   46</a></span>&#160;%            =3 --&gt; weight=1/<a class="code" href="interch_8m.html#ae4e69912f5a2f923a187c235f950a7d2">abs</a>(Yijw)      ; indvidual element <a class="code" href="_q_ppassive_8m.html#a1d55f8bde712a83fc0abaddd0e76d831">weighting</a></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;%            =4 --&gt; weight=1/sqrt(norm(Yw)) ; common <a class="code" href="_q_ppassive_8m.html#a1d55f8bde712a83fc0abaddd0e76d831">weighting</a> <span class="keywordflow">for</span> all <a class="code" href="find_complex_rational_approximation_8m.html#abe2340411a23afe1be8f0a486a4c92f1">matrix</a> <a class="code" href="_q_ppassive_8m.html#a712f8497424fce048b75fff1f16f2ebd">elements</a></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;%            =5 --&gt; weight=1/norm(Yw)       ; common <a class="code" href="_q_ppassive_8m.html#a1d55f8bde712a83fc0abaddd0e76d831">weighting</a> <span class="keywordflow">for</span> all <a class="code" href="find_complex_rational_approximation_8m.html#abe2340411a23afe1be8f0a486a4c92f1">matrix</a> <a class="code" href="_q_ppassive_8m.html#a712f8497424fce048b75fff1f16f2ebd">elements</a></div>
<div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="_q_ppassive_8m.html#aea4e41a0bec964966ccd0f3632106868">   49</a></span>&#160;%</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;%  <a class="code" href="_q_ppassive_8m.html#aea4e41a0bec964966ccd0f3632106868">auxflag</a>   =1 --&gt; Routine inserts additional samples for LS problem outside the</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;%                   <a class="code" href="vectfit3_8m.html#a5d35b2657f4cd1c457b35c41a6d0075e">fitting</a> range. One sample at each pole location (SERAsub).</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;%</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;%  weightfactor : Factor defining the total weighting of additional samples outside</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;%                 the fitting range, relative to the total weighting of samples in the</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;%                 fitting range. Is only used if auxflag=1. </div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;%                 Default value: 1e-3</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;% -----------------------------------------------------------------------------------  </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;%  CONSTRAINT PART:</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;%</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;%  SERAsub(Nsub,1)     : Poles to be included in QP</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;%  SERCsub(Nc,Nc,Nsub) : Associated residues</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;%</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;%  s2(1,Ns2) (jw [rad/sec])  : List of frequencies. Will include in constraint problem</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;%                              eigenvalues which violate the passivity criterion at </div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;%                              these frequencies</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;%</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;%  s3(1,Ns3) (jw [rad/sec])  : List of frequencies. Will include in constraint problem </div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;%                              all eigenvalues at these frequencies.</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;%                               </div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;% =================================================</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;%     OUTPUT :</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;% =================================================</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;%  SERCnew(Nc,Nc,Nsub) : Updated residues  </div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;%  SERDnew(Nc,Nc)      : Updated constant term  </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;%</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;% *********************************************************************************** </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;%  NOTE: This program is in the public domain and may be used by anyone. If the     *</div>
<div class="line"><a name="l00078"></a><span class="lineno"><a class="line" href="_q_ppassive_8m.html#a9ee7cc8324bd8d5894e6fba8f34294e9">   78</a></span>&#160;%        program code (or <a class="code" href="generate_p_r_r_file_8m.html#a45d9f8dad1bcc7195d94b27e4ab44377">a</a> modified version) is used in a scientific work or       *</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;%        in a commercial program, then reference should be made to the following:   *</div>
<div class="line"><a name="l00080"></a><span class="lineno"><a class="line" href="_q_ppassive_8m.html#aea0f0b307bae86e5f2cc741db7911967">   80</a></span>&#160;%        B. Gustavsen and A. Semlyen, &quot;Enforcing Passivity for Admittance Matrices  *</div>
<div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="_q_ppassive_8m.html#a7d91f81694976146b3a75aadac28afa0">   81</a></span>&#160;%        Approximated by Rational Functions, IEEE Trans. Power Systems,             *  </div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;%        vol. 16, no. 1, pp. 97-104, Feb. 2001.                                     *  </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;% ***********************************************************************************</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;%</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;% This file is part of the QPpassive.zip toolbox</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;%</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;% ***********************************************************************************</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;%</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;% Bug fixes:</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;% 21.10.2004 - Several bugs related to usage of cindexsub corrected. </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;% 11.03.07   - Input parameter weighfactor correcctly included in the code.</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;%            - Proper dimensioning of array bigA2 </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;% ***********************************************************************************</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160; </div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;%  11.04.2007: Added option for using CPLEX over quadprog, see below.</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;%</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160; </div>
<div class="line"><a name="l00098"></a><span class="lineno"><a class="line" href="_q_ppassive_8m.html#a2debe316c6874c013213554b33d598bf">   98</a></span>&#160;solver=&#39;quadprog&#39;;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;%<a class="code" href="_q_ppassive_8m.html#a2debe316c6874c013213554b33d598bf">solver</a>=<span class="stringliteral">&#39;cplex   &#39;</span>; %Requires installment of CPLEX (http:<span class="comment">//tomopt.com/)</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160; </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160; </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;SERCsubnew=SERCsub; SERDnew=SERD; SEREnew=SERE;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160; </div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160; </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;N=length(SERA);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;Nsub=length(SERAsub); </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160; </div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;bigA=sparse([]);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;bigb=[];</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;bigB=[];</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;bigc=[];</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;Ns=length(<a class="code" href="find_complex_rational_approximation_8m.html#ace5ae57a640fd6f3b4e6ed038aac371f">s</a>);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;Ns2=length(s2);</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;Nc=length(SERD);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;I=eye(Nc);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;M2mat=[];</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160; </div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160; </div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;%=======================================================</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;% Finding out which <a class="code" href="find_complex_rational_approximation_8m.html#a941bc79a8e80f2d30662d054fb5648f7">poles</a> are complex :</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;%=======================================================</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;% LS problem:</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;cindex=zeros(1,N);</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="keywordflow">for</span> <a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>=1:N </div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="keywordflow">if</span> imag(SERA(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>))~=0  </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordflow">if</span> <a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>==1 </div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      cindex(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)=1;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      <span class="keywordflow">if</span> cindex(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>-1)==0 | cindex(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>-1)==2</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        cindex(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)=1; cindex(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>+1)=2; </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        cindex(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)=2;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      end</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    end </div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  end</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;end</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160; </div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;% Constraint problem:</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;cindexsub=zeros(1,Nsub);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="keywordflow">for</span> <a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>=1:Nsub </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="keywordflow">if</span> imag(SERAsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>))~=0 </div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordflow">if</span> <a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>==1 </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;      cindexsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)=1; </div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      <span class="keywordflow">if</span> cindexsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>-1)==0 | cindexsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>-1)==2</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        cindexsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)=1; cindexsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>+1)=2; </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        cindexsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)=2;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;      end</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    end </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  end</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;end</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;%========================================</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;% LOOP FOR LEAST SQUARES PROBLEM:</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;%========================================</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;nnn=Nc;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="keywordflow">for</span> row=1:min(bw,Nc)</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  nnn=nnn+(Nc-row);  %nnn is the number of <a class="code" href="_q_ppassive_8m.html#a712f8497424fce048b75fff1f16f2ebd">elements</a> in Y to be put in solution vector</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;end</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160; </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="keywordflow">if</span> weightflag==4 | weightflag==5</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  weightarr=ones(1,Ns);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="keywordflow">for</span> <a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>=1:Ns</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    sk=<a class="code" href="find_complex_rational_approximation_8m.html#ace5ae57a640fd6f3b4e6ed038aac371f">s</a>(<a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>);</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordflow">for</span> row=1:Nc</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      <span class="keywordflow">for</span> col=row:min(row+bw,Nc)</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        Y(row,col)=SERD(row,col)+sk*SERE(row,col);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        Y(row,col)=Y(row,col)+<a class="code" href="rot_8m.html#a08a8fae29827bd080fd336a8b6ba58c6">sum</a>(squeeze(SERC(row,col,1:N))./(<a class="code" href="find_complex_rational_approximation_8m.html#ace5ae57a640fd6f3b4e6ed038aac371f">s</a>(<a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>)-SERA(1:N)));</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      end</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    end</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordflow">if</span> weightflag==4 </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      weightarr(<a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>)=1/sqrt(norm(Y));</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    elseif weightflag==5 </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      weightarr(<a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>)=1/norm(Y);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    end</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  end %<span class="keywordflow">for</span> <a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>=1:Ns</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;end %<span class="keywordflow">if</span> weightflag==4 | weightflag==5</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160; </div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;bigA=zeros(Ns*nnn,nnn*(Nsub+1));</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="keywordflow">for</span> <a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>=1:Ns</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  sk=<a class="code" href="find_complex_rational_approximation_8m.html#ace5ae57a640fd6f3b4e6ed038aac371f">s</a>(<a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  % Calculating <a class="code" href="find_complex_rational_approximation_8m.html#abe2340411a23afe1be8f0a486a4c92f1">matrix</a> Mmat (coefficients <span class="keywordflow">for</span> LS-problem)</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  tell=0;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  offs=0;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160; </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="keywordflow">for</span> row=1:Nc</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    ind2=0;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordflow">for</span> col=row:min(row+bw,Nc)</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      y=SERD(row,col)+sk*SERE(row,col);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      y=y+<a class="code" href="rot_8m.html#a08a8fae29827bd080fd336a8b6ba58c6">sum</a>(squeeze(SERC(row,col,1:N))./(<a class="code" href="find_complex_rational_approximation_8m.html#ace5ae57a640fd6f3b4e6ed038aac371f">s</a>(<a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>)-SERA(1:N)));</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      <span class="keywordflow">if</span> weightflag==1</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        weight=1;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      elseif weightflag==2</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        weight=1/sqrt(<a class="code" href="interch_8m.html#ae4e69912f5a2f923a187c235f950a7d2">abs</a>(y));</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      elseif weightflag==3</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        weight=1/<a class="code" href="interch_8m.html#ae4e69912f5a2f923a187c235f950a7d2">abs</a>(y); </div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      elseif weightflag==4 | weightflag==5</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        weight=weightarr(<a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>);</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="stringliteral">&#39;ERROR!!!!!!!!!&#39;</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        weight=1;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      end</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160; </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      <span class="keywordflow">if</span> row==col</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        faktor1=weight*1;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        faktor1=weight*sqrt(2);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      end</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160; </div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      tell=tell+1;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      <span class="keywordflow">for</span> <a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>=1:Nsub</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;       <span class="keywordflow">if</span> cindexsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)==0      %real pole</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;         Mmat(tell,offs+<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)=faktor1*1/(sk-SERAsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>));</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;       elseif cindexsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)==1  %complex pole, 1st part</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;         Mmat(tell,offs+<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)=  faktor1* (1/(sk-SERAsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)) + 1/(sk-SERAsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)&#39;) );</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;         Mmat(tell,offs+<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>+1)=faktor1* (<a class="code" href="generate_p_r_r_file_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>/(sk-SERAsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)) - <a class="code" href="generate_p_r_r_file_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>/(sk-SERAsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)&#39;) ); </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        end</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      end %<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      Mmat(tell,offs+Nsub+1)=faktor1*1; </div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      offs=offs + (Nsub+1);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    end %col</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  end %row</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;       </div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  bigA((<a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>-1)*nnn+1:<a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>*nnn,:)=Mmat;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  </div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;end %<span class="keywordflow">for</span> <a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>=1:Ns</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;bigb=zeros(length(bigA(:,1)),1);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160; </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160; </div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;%========================================</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;% INTRODUCING SAMPLES OUTSIDE LS REGION: ONE SAMPLE PER POLE (s4)</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;%========================================</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="keywordflow">if</span> <a class="code" href="_q_ppassive_8m.html#aea4e41a0bec964966ccd0f3632106868">auxflag</a>==1</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;s4=[];    </div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;tell=0;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="keywordflow">for</span> <a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>=1:length(SERAsub)</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <span class="keywordflow">if</span> cindexsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)==0 %real pole</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordflow">if</span> ( ( <a class="code" href="interch_8m.html#ae4e69912f5a2f923a187c235f950a7d2">abs</a>(SERAsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>))&gt;<a class="code" href="find_complex_rational_approximation_8m.html#ace5ae57a640fd6f3b4e6ed038aac371f">s</a>(Ns)/<a class="code" href="interch_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> ) | ( <a class="code" href="interch_8m.html#ae4e69912f5a2f923a187c235f950a7d2">abs</a>(SERAsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>))&lt;<a class="code" href="find_complex_rational_approximation_8m.html#ace5ae57a640fd6f3b4e6ed038aac371f">s</a>(1)/<a class="code" href="interch_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> ) )</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      tell=tell+1;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      s4(tell)=<a class="code" href="interch_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>*<a class="code" href="interch_8m.html#ae4e69912f5a2f923a187c235f950a7d2">abs</a>(SERAsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>));</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    end</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  elseif cindexsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)==1 %complex pole, first part</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordflow">if</span> ( ( <a class="code" href="interch_8m.html#ae4e69912f5a2f923a187c235f950a7d2">abs</a>(imag(SERAsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)))&gt;<a class="code" href="find_complex_rational_approximation_8m.html#ace5ae57a640fd6f3b4e6ed038aac371f">s</a>(Ns)/<a class="code" href="interch_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> ) | ( <a class="code" href="interch_8m.html#ae4e69912f5a2f923a187c235f950a7d2">abs</a>(imag(SERAsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)))&lt;<a class="code" href="find_complex_rational_approximation_8m.html#ace5ae57a640fd6f3b4e6ed038aac371f">s</a>(1)/<a class="code" href="interch_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a> ) )</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      tell=tell+1;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      s4(tell)=<a class="code" href="interch_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a>*<a class="code" href="interch_8m.html#ae4e69912f5a2f923a187c235f950a7d2">abs</a>(imag(SERAsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)));</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    end</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  end</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;end</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;Ns4=length(s4);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160; </div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160; </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;%Weighting:</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="keywordflow">if</span> weightflag==4 | weightflag==5</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  weightarr4=ones(1,Ns4);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <span class="keywordflow">for</span> <a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>=1:Ns4</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    sk=s4(<a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="keywordflow">for</span> row=1:Nc</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      <span class="keywordflow">for</span> col=row:min(row+bw,Nc)</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        Y(row,col)=SERD(row,col)+sk*SERE(row,col);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        Y(row,col)=Y(row,col)+<a class="code" href="rot_8m.html#a08a8fae29827bd080fd336a8b6ba58c6">sum</a>(squeeze(SERC(row,col,1:N))./(<a class="code" href="find_complex_rational_approximation_8m.html#ace5ae57a640fd6f3b4e6ed038aac371f">s</a>(<a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>)-SERA(1:N)));</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      end</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    end</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keywordflow">if</span> weightflag==4 </div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      weightarr4(<a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>)=1/sqrt(norm(Y));</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    elseif weightflag==5 </div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      weightarr4(<a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>)=1/norm(Y);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    end</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  end %<span class="keywordflow">for</span> <a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>=1:Ns4</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;end %<span class="keywordflow">if</span> weightflag==4 | weightflag==5</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160; </div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160; </div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160; </div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;nnn=Nc;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="keywordflow">for</span> row=1:min(bw,Nc)</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  nnn=nnn+(Nc-row);</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;end</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160; </div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;bigA2=zeros(Ns4*nnn,nnn*(Nsub+1));</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="keywordflow">for</span> <a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>=1:Ns4</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  sk=s4(<a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160; </div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  % Calculating <a class="code" href="find_complex_rational_approximation_8m.html#abe2340411a23afe1be8f0a486a4c92f1">matrix</a> Mmat (coefficients <span class="keywordflow">for</span> LS-problem)</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  tell=0;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  offs=0;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160; </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="keywordflow">for</span> row=1:Nc</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    ind2=0;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keywordflow">for</span> col=row:min(row+bw,Nc)</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      <span class="keywordflow">if</span> weightflag==1</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        weight=1;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      elseif weightflag==2</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        weight=1/sqrt(<a class="code" href="interch_8m.html#ae4e69912f5a2f923a187c235f950a7d2">abs</a>(y));</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      elseif weightflag==3</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        weight=1/<a class="code" href="interch_8m.html#ae4e69912f5a2f923a187c235f950a7d2">abs</a>(y); </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      elseif weightflag==4 | weightflag==5</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        weight=weightarr4(<a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        <span class="stringliteral">&#39;ERROR!!!!!!!!!&#39;</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        weight=1;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      end</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160; </div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      <span class="keywordflow">if</span> row==col</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        faktor1=weight;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        faktor1=weight*sqrt(2);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      end</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      faktor1=weightfactor*faktor1;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      tell=tell+1;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      <span class="keywordflow">for</span> <a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>=1:Nsub</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;       <span class="keywordflow">if</span> cindexsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)==0      %real pole</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;         Mmat(tell,offs+<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)=faktor1*1/(sk-SERAsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>));</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;       elseif cindexsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)==1  %complex pole, 1st part</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;         Mmat(tell,offs+<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)=  faktor1* (1/(sk-SERAsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)) + 1/(sk-SERAsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)&#39;) );</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;         Mmat(tell,offs+<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>+1)=faktor1* (<a class="code" href="generate_p_r_r_file_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>/(sk-SERAsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)) - <a class="code" href="generate_p_r_r_file_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>/(sk-SERAsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)&#39;) ); %!!!!!</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        end</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      end %<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      Mmat(tell,offs+Nsub+1)=faktor1*1; </div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      offs=offs + (Nsub+1);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160; </div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    end %col</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  end %row</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;       </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  bigA2((<a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>-1)*nnn+1:<a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>*nnn,:)=Mmat;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  </div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;end %<span class="keywordflow">for</span> <a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>=1:Ns</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;bigA=[bigA;bigA2];</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;bigb=zeros(length(bigA(:,1)),1);</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160; </div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;end %<span class="keywordflow">if</span> <a class="code" href="_q_ppassive_8m.html#aea4e41a0bec964966ccd0f3632106868">auxflag</a>==1</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160; </div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;%========================================</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;% LOOP FOR CONSTRAINT PROBLEM, TYPE #1 (violating eigenvalues in s2):</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;%========================================</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="keywordflow">for</span> <a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>=1:Ns2</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  sk=s2(<a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <span class="keywordflow">for</span> row=1:Nc</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keywordflow">for</span> col=1:Nc</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      Y(row,col)=SERD(row,col)+sk*SERE(row,col);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      Y(row,col)=Y(row,col)+<a class="code" href="rot_8m.html#a08a8fae29827bd080fd336a8b6ba58c6">sum</a>(squeeze(SERC(row,col,1:N))./(sk-SERA(1:N)));</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    end</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  end </div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160; </div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  %Calculating eigenvalues and eigenvectors: </div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  [V,Z] = eig(real(Y)); Z=diag(Z);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  EE(:,<a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>)=real(Z);</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <span class="keywordflow">if</span> min(real(Z))&lt;0  %any violations</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160; </div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    % Calculating <a class="code" href="find_complex_rational_approximation_8m.html#abe2340411a23afe1be8f0a486a4c92f1">matrix</a> M2mat; <a class="code" href="find_complex_rational_approximation_8m.html#abe2340411a23afe1be8f0a486a4c92f1">matrix</a> of partial derivatives :</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    tell=0;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    offs=0;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160; </div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordflow">for</span> row=1:Nc</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      ind2=0;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      <span class="keywordflow">for</span> col=row:min(row+bw,Nc)</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        <span class="keywordflow">if</span> row==col</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;          faktor2=1;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;          faktor2=2;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        end</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        tell=tell+1;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <span class="keywordflow">for</span> <a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>=1:Nsub</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;          <span class="keywordflow">if</span> cindexsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)==0      %real pole</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            Mmat2(tell,offs+<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)=faktor2*1/(sk-SERAsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>));</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;          elseif cindexsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)==1  %complex pole, 1st part</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            Mmat2(tell,offs+<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)=  faktor2* (1/(sk-SERAsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)) + 1/(sk-SERAsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)&#39;) );</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            Mmat2(tell,offs+<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>+1)=faktor2* (<a class="code" href="generate_p_r_r_file_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>/(sk-SERAsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)) - <a class="code" href="generate_p_r_r_file_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>/(sk-SERAsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)&#39;) );</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;          end                  </div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        end %<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        Ndum=Nsub;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        Mmat2(tell,offs+Ndum+1)=faktor2*1; </div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        offs=offs + (Nsub+1);</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      end %col</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    end %row</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160; </div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="keywordflow">for</span> n=1:Nc</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      tell=0;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      V1=V(:,n); </div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      <span class="keywordflow">for</span> row=1:Nc</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        <span class="keywordflow">for</span> col=row:min(row+bw,Nc) </div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;          <span class="keywordflow">if</span> row==col</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;            qij=V1(row)^2;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            qij=V1(row)*V1(col); </div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;          end</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;          tell=tell+1;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;          Q(n,tell)=qij;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        end</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;      end</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    end</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160; </div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160; </div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    B=Q*Mmat2; </div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    delz=real(Z);</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordflow">for</span> n=1:Nc   %ustabilitet?</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      <span class="keywordflow">if</span> delz(n)&lt;0</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        bigB=[bigB;B(n,:)];</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        bigc=[bigc;-TOL+delz(n)];</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      end</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    end</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;          </div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  end %<span class="keywordflow">if</span> max(real(Z))&gt;0  %any violations</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  </div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;end %<a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160; </div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160; </div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160; </div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;%========================================</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;% LOOP FOR CONSTRAINT PROBLEM, TYPE #2: (all eigenvalues in s3):</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;%========================================</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;Ns3=length(s3);</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="keywordflow">for</span> <a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>=1:1:Ns3</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  sk=s3(<a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>);</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="keywordflow">for</span> row=1:Nc</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="keywordflow">for</span> col=1:Nc</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;      Y(row,col)=SERD(row,col)+sk*SERE(row,col);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;      Y(row,col)=Y(row,col)+<a class="code" href="rot_8m.html#a08a8fae29827bd080fd336a8b6ba58c6">sum</a>(squeeze(SERC(row,col,1:N))./(sk-SERA(1:N)));</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    end</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  end</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  %Calculating eigenvalues and eigenvectors: </div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  [V,Z] = eig(real(Y)); Z=diag(Z);</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  EE(:,<a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>)=real(Z);</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160; </div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    % Calculating <a class="code" href="find_complex_rational_approximation_8m.html#abe2340411a23afe1be8f0a486a4c92f1">matrix</a> M2mat; <a class="code" href="find_complex_rational_approximation_8m.html#abe2340411a23afe1be8f0a486a4c92f1">matrix</a> of partial derivatives :</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    tell=0;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    offs=0;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160; </div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="keywordflow">for</span> row=1:Nc</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      ind2=0;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      <span class="keywordflow">for</span> col=row:min(row+bw,Nc)</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        <span class="keywordflow">if</span> row==col</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;          faktor2=1;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;          faktor2=2;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        end</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        tell=tell+1;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        <span class="keywordflow">for</span> <a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>=1:Nsub</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;          <span class="keywordflow">if</span> cindexsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)==0      %real pole</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            Mmat2(tell,offs+<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)=faktor2*1/(sk-SERA(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>));</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;          elseif cindexsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)==1  %complex pole, 1st part</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            Mmat2(tell,offs+<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)=  faktor2* (1/(sk-SERAsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)) + 1/(sk-SERAsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)&#39;) );</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;            Mmat2(tell,offs+<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>+1)=faktor2* (<a class="code" href="generate_p_r_r_file_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>/(sk-SERAsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)) - <a class="code" href="generate_p_r_r_file_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>/(sk-SERAsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)&#39;) );</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;          end                  </div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        end %<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        Ndum=Nsub;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        Mmat2(tell,offs+Ndum+1)=faktor2*1; </div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        offs=offs + (Nsub+1);</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      end %col</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    end %row</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160; </div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keywordflow">for</span> n=1:Nc</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      tell=0;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      V1=V(:,n); </div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;      <span class="keywordflow">for</span> row=1:Nc</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        <span class="keywordflow">for</span> col=row:min(row+bw,Nc) </div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;          <span class="keywordflow">if</span> row==col</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            qij=V1(row)^2;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;            qij=V1(row)*V1(col); </div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;          end</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;          tell=tell+1;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;          Q(n,tell)=qij;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        end</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      end</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    end</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160; </div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160; </div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    B=Q*Mmat2; </div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    delz=real(Z);</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordflow">for</span> n=1:Nc   </div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      bigB=[bigB;B(n,:)];</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      bigc=[bigc;-TOL+delz(n)];</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    end</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  </div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;end %<span class="keywordflow">for</span> <a class="code" href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a>=1:1:Ns3</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160; </div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="keywordflow">if</span> length(bigB)==0 </div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  <span class="keywordflow">return</span>   %No passivity violations</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;end</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160; </div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160; </div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;c=bigc;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160; </div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;bigA=[real(bigA); imag(bigA)];</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;bigb=[real(bigb); imag(bigb)];</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;bigB=[real(bigB)];</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;bigA=sparse(bigA);</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160; </div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160; </div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;Acol=length(bigA(1,:));</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="keywordflow">for</span> col=1:Acol</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  Escale(col)=norm(bigA(:,col),2);</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  bigA(:,col)=bigA(:,col)./Escale(col);</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  <span class="keywordflow">if</span> length(bigB)&gt;0</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    bigB(:,col)=bigB(:,col)./Escale(col);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  end</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;end</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160; </div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<a class="code" href="get_residues_8m.html#ad4f77c10e1e7f457cb8c095f0f16a59b">H</a>=bigA.<span class="stringliteral">&#39;*bigA;</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="stringliteral">ff=bigA.&#39;</span>*bigb;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<a class="code" href="get_residues_8m.html#ad4f77c10e1e7f457cb8c095f0f16a59b">H</a>=full(<a class="code" href="get_residues_8m.html#ad4f77c10e1e7f457cb8c095f0f16a59b">H</a>);</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160; </div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160; </div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;clear bigA;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160; </div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;warning <a class="code" href="comp_8m.html#a835accca41274fb237599d9b3c117fcf">off</a></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;tic</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160; </div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="keywordflow">if</span> <a class="code" href="_q_ppassive_8m.html#a2debe316c6874c013213554b33d598bf">solver</a>==<span class="stringliteral">&#39;quadprog&#39;</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;     <a class="code" href="transistor_comparison_8m.html#ab2ef037fa1090e2d820de186fbabb641">disp</a>(<span class="stringliteral">&#39;Starting quadprog...&#39;</span>)</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    [dx,lambda]=quadprog(<a class="code" href="get_residues_8m.html#ad4f77c10e1e7f457cb8c095f0f16a59b">H</a>,ff,-bigB,bigc,[],[],[],[],[],optimoptions(<span class="stringliteral">&#39;quadprog&#39;</span>,<span class="stringliteral">&#39;MaxIterations&#39;</span>,2e4));</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;elseif <a class="code" href="_q_ppassive_8m.html#a2debe316c6874c013213554b33d598bf">solver</a>==<span class="stringliteral">&#39;cplex   &#39;</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  c=0*ff;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  H0=c.<span class="stringliteral">&#39;;</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="stringliteral">  %F=sparse(H);</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="stringliteral">  A=-bigB; </span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="stringliteral">  H=sparse(H); %A=sparse(A);</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="stringliteral">  x_0=zeros(length(H(:,1)));</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="stringliteral">  b_U=bigc;</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="stringliteral">  b_L = -inf*ones(length(b_U),1);</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="stringliteral">  x_L = -inf*ones(length(x_0),1);</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="stringliteral">  x_U = inf*ones(length(x_0),1);</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="stringliteral">  disp(&#39;</span>Starting CPLEX...<span class="stringliteral">&#39;) </span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="stringliteral">  Prob = qpAssign(H,c,A,b_L,b_U,x_L,x_U,x_0,&#39;</span>dust<span class="stringliteral">&#39;);</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="stringliteral">  Prob.MIP.cpxControl.QPMETHOD = 4;</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="stringliteral">  Prob.MIP.cpxControl.BARALG = 2; %2</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="stringliteral">  PriLev = 0;</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="stringliteral">  Prob.PriLevOpt = 0;</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="stringliteral">  [x, slack, v, rc, f_k] = cplex(c, A, x_L, x_U, b_L, b_U, ...</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="stringliteral">           Prob.MIP.cpxControl, [], PriLev, Prob, [], [], [], [], ...</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="stringliteral">           [], [], H); </span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="stringliteral">  dx=x;</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="stringliteral">else</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="stringliteral">  &#39;</span>ERROR: invalid value <span class="keywordflow">for</span> <a class="code" href="_q_ppassive_8m.html#a2debe316c6874c013213554b33d598bf">solver</a><span class="stringliteral">&#39;   </span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="stringliteral">end</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="stringliteral">disp([&#39;</span>Elapsed <a class="code" href="comp_8m.html#a1b8ddf2508d97040f85b97c48a566efd">time</a>: <span class="stringliteral">&#39; num2str(toc) &#39;</span> sec<span class="stringliteral">&#39;])</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="stringliteral">warning on</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="stringliteral"></span> </div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="stringliteral">dx=dx./Escale.&#39;</span>;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160; </div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160; </div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160; </div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;%Converting dx so that the <a class="code" href="find_complex_rational_approximation_8m.html#aa47f8fd22c40ce45ebd5dd23fa0319f6">residues</a> become complex:</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;tell=0;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="keywordflow">for</span> row=1:Nc</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  <span class="keywordflow">for</span> col=row:min(row+bw,Nc)</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordflow">for</span> <a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>=1:Nsub</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      tell=tell+1;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      <span class="keywordflow">if</span> cindexsub(<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)==1</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        r1=dx(tell); r2=dx(tell+1);</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        dx(tell)=r1+<a class="code" href="generate_p_r_r_file_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>*r2; dx(tell+1)=r1-<a class="code" href="generate_p_r_r_file_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>*r2; </div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;      end</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    end %<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    tell=tell+1; %Skip SERD</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  end %col</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;end %row</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160; </div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160; </div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;%Updating SERC, SERD:</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;tell=0;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="keywordflow">for</span> row=1:Nc</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;  <span class="keywordflow">for</span> col=row:min(row+bw,Nc)</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    Ndum=Nsub;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <span class="keywordflow">for</span> <a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>=1:Nsub </div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      tell=tell+1;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;      SERCsubnew(row,col,<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)=SERCsubnew(row,col,<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)+dx(tell);</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;      <span class="keywordflow">if</span> row~=col</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        SERCsubnew(col,row,<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)=SERCsubnew(col,row,<a class="code" href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a>)+dx(tell); </div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      end</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    end</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    SERDnew(row,col)=SERDnew(row,col)+dx(tell+1);</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordflow">if</span> row~=col</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;      SERDnew(col,row)=SERDnew(col,row)+dx(tell+1);</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    end</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    tell=tell+1;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  end</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;end </div>
<div class="ttc" id="a_q_ppassive_8m_html_a1d55f8bde712a83fc0abaddd0e76d831"><div class="ttname"><a href="_q_ppassive_8m.html#a1d55f8bde712a83fc0abaddd0e76d831">weighting</a></div><div class="ttdeci">indvidual element weighting</div><div class="ttdef"><b>Definition:</b> <a href="_q_ppassive_8m_source.html#l00044">QPpassive.m:45</a></div></div>
<div class="ttc" id="a_q_ppassive_8m_html_a2debe316c6874c013213554b33d598bf"><div class="ttname"><a href="_q_ppassive_8m.html#a2debe316c6874c013213554b33d598bf">solver</a></div><div class="ttdeci">solver</div><div class="ttdef"><b>Definition:</b> <a href="_q_ppassive_8m_source.html#l00098">QPpassive.m:98</a></div></div>
<div class="ttc" id="a_q_ppassive_8m_html_a712f8497424fce048b75fff1f16f2ebd"><div class="ttname"><a href="_q_ppassive_8m.html#a712f8497424fce048b75fff1f16f2ebd">elements</a></div><div class="ttdeci">common weighting for all matrix elements</div><div class="ttdef"><b>Definition:</b> <a href="_q_ppassive_8m_source.html#l00046">QPpassive.m:47</a></div></div>
<div class="ttc" id="a_q_ppassive_8m_html_a7d91f81694976146b3a75aadac28afa0"><div class="ttname"><a href="_q_ppassive_8m.html#a7d91f81694976146b3a75aadac28afa0">no</a></div><div class="ttdeci">common weighting for all matrix elements relative to the total weighting of samples in the fitting range Is only used if then reference should be made to the Enforcing Passivity for Admittance Matrices *Approximated by Rational IEEE Trans Power no</div><div class="ttdef"><b>Definition:</b> <a href="_q_ppassive_8m_source.html#l00081">QPpassive.m:81</a></div></div>
<div class="ttc" id="a_q_ppassive_8m_html_a879d0e439ff91148c53bf3bf5e40d357"><div class="ttname"><a href="_q_ppassive_8m.html#a879d0e439ff91148c53bf3bf5e40d357">QPpassive</a></div><div class="ttdeci">bw, SERA, SERC, SERD, SERE, s, weightflag,... % auxflag, weightfactor, SERAsub, SERCsub, s2, s3, TOL QPpassive()</div></div>
<div class="ttc" id="a_q_ppassive_8m_html_ab20e317c6d731cc3115f2630675017be"><div class="ttname"><a href="_q_ppassive_8m.html#ab20e317c6d731cc3115f2630675017be">m</a></div><div class="ttdeci">PURPOSE j m</div><div class="ttdef"><b>Definition:</b> <a href="_q_ppassive_8m_source.html#l00021">QPpassive.m:21</a></div></div>
<div class="ttc" id="a_q_ppassive_8m_html_aea4e41a0bec964966ccd0f3632106868"><div class="ttname"><a href="_q_ppassive_8m.html#aea4e41a0bec964966ccd0f3632106868">auxflag</a></div><div class="ttdeci">common weighting for all matrix elements auxflag</div><div class="ttdef"><b>Definition:</b> <a href="_q_ppassive_8m_source.html#l00049">QPpassive.m:49</a></div></div>
<div class="ttc" id="a_q_ppassive_8m_html_aefa3a44886c8a1eaa39cf45cc918a59a"><div class="ttname"><a href="_q_ppassive_8m.html#aefa3a44886c8a1eaa39cf45cc918a59a">function</a></div><div class="ttdeci">function[SERCsubnew, SERDnew]</div><div class="ttdef"><b>Definition:</b> <a href="_q_ppassive_8m_source.html#l00001">QPpassive.m:1</a></div></div>
<div class="ttc" id="acomp_8m_html_a1b8ddf2508d97040f85b97c48a566efd"><div class="ttname"><a href="comp_8m.html#a1b8ddf2508d97040f85b97c48a566efd">time</a></div><div class="ttdeci">if d time</div><div class="ttdef"><b>Definition:</b> <a href="comp_8m_source.html#l00006">comp.m:6</a></div></div>
<div class="ttc" id="acomp_8m_html_a835accca41274fb237599d9b3c117fcf"><div class="ttname"><a href="comp_8m.html#a835accca41274fb237599d9b3c117fcf">off</a></div><div class="ttdeci">hold off</div><div class="ttdef"><b>Definition:</b> <a href="comp_8m_source.html#l00012">comp.m:12</a></div></div>
<div class="ttc" id="afind_complex_rational_approximation_8m_html_a941bc79a8e80f2d30662d054fb5648f7"><div class="ttname"><a href="find_complex_rational_approximation_8m.html#a941bc79a8e80f2d30662d054fb5648f7">poles</a></div><div class="ttdeci">Undo scaling of outgoing poles</div><div class="ttdef"><b>Definition:</b> <a href="find_complex_rational_approximation_8m_source.html#l00070">findComplexRationalApproximation.m:70</a></div></div>
<div class="ttc" id="afind_complex_rational_approximation_8m_html_aa47f8fd22c40ce45ebd5dd23fa0319f6"><div class="ttname"><a href="find_complex_rational_approximation_8m.html#aa47f8fd22c40ce45ebd5dd23fa0319f6">residues</a></div><div class="ttdeci">Undo scaling of outgoing residues</div><div class="ttdef"><b>Definition:</b> <a href="find_complex_rational_approximation_8m_source.html#l00070">findComplexRationalApproximation.m:70</a></div></div>
<div class="ttc" id="afind_complex_rational_approximation_8m_html_abe2340411a23afe1be8f0a486a4c92f1"><div class="ttname"><a href="find_complex_rational_approximation_8m.html#abe2340411a23afe1be8f0a486a4c92f1">matrix</a></div><div class="ttdeci">Turn this into a matrix</div><div class="ttdef"><b>Definition:</b> <a href="find_complex_rational_approximation_8m_source.html#l00025">findComplexRationalApproximation.m:25</a></div></div>
<div class="ttc" id="afind_complex_rational_approximation_8m_html_ace5ae57a640fd6f3b4e6ed038aac371f"><div class="ttname"><a href="find_complex_rational_approximation_8m.html#ace5ae57a640fd6f3b4e6ed038aac371f">s</a></div><div class="ttdeci">Turn this into a with identical frequencies along the rows s</div><div class="ttdef"><b>Definition:</b> <a href="find_complex_rational_approximation_8m_source.html#l00026">findComplexRationalApproximation.m:26</a></div></div>
<div class="ttc" id="agenerate_p_r_r_file_8m_html_a45d9f8dad1bcc7195d94b27e4ab44377"><div class="ttname"><a href="generate_p_r_r_file_8m.html#a45d9f8dad1bcc7195d94b27e4ab44377">a</a></div><div class="ttdeci">Find a complex rational model for freq domain data for a</div><div class="ttdef"><b>Definition:</b> <a href="generate_p_r_r_file_8m_source.html#l00013">generatePRRFile.m:13</a></div></div>
<div class="ttc" id="agenerate_p_r_r_file_8m_html_a6f6ccfcf58b31cb6412107d9d5281426"><div class="ttname"><a href="generate_p_r_r_file_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a></div><div class="ttdeci">for i</div><div class="ttdef"><b>Definition:</b> <a href="generate_p_r_r_file_8m_source.html#l00019">generatePRRFile.m:19</a></div></div>
<div class="ttc" id="aget_residues_8m_html_ad4f77c10e1e7f457cb8c095f0f16a59b"><div class="ttname"><a href="get_residues_8m.html#ad4f77c10e1e7f457cb8c095f0f16a59b">H</a></div><div class="ttdeci">Check fit H</div><div class="ttdef"><b>Definition:</b> <a href="get_residues_8m_source.html#l00064">getResidues.m:64</a></div></div>
<div class="ttc" id="ainterch_8m_html_a1c73327b2882639bc9f5e416bb3cc7ac"><div class="ttname"><a href="interch_8m.html#a1c73327b2882639bc9f5e416bb3cc7ac">k</a></div><div class="ttdeci">for k</div><div class="ttdef"><b>Definition:</b> <a href="interch_8m_source.html#l00015">interch.m:15</a></div></div>
<div class="ttc" id="ainterch_8m_html_ac86694252f8dfdb19aaeadc4b7c342c6"><div class="ttname"><a href="interch_8m.html#ac86694252f8dfdb19aaeadc4b7c342c6">j</a></div><div class="ttdeci">for j</div><div class="ttdef"><b>Definition:</b> <a href="interch_8m_source.html#l00013">interch.m:13</a></div></div>
<div class="ttc" id="ainterch_8m_html_ae4e69912f5a2f923a187c235f950a7d2"><div class="ttname"><a href="interch_8m.html#ae4e69912f5a2f923a187c235f950a7d2">abs</a></div><div class="ttdeci">end if abs(real(dotprod))&gt;rstoerst rstoerst</div></div>
<div class="ttc" id="arot_8m_html_a08a8fae29827bd080fd336a8b6ba58c6"><div class="ttname"><a href="rot_8m.html#a08a8fae29827bd080fd336a8b6ba58c6">sum</a></div><div class="ttdeci">Square sum(error) of solution aaa=0.0</div></div>
<div class="ttc" id="atransistor_comparison_8m_html_ab2ef037fa1090e2d820de186fbabb641"><div class="ttname"><a href="transistor_comparison_8m.html#ab2ef037fa1090e2d820de186fbabb641">disp</a></div><div class="ttdeci">disp(&quot;done&quot;)</div></div>
<div class="ttc" id="avectfit3_8m_html_a5d35b2657f4cd1c457b35c41a6d0075e"><div class="ttname"><a href="vectfit3_8m.html#a5d35b2657f4cd1c457b35c41a6d0075e">fitting</a></div><div class="ttdeci">Include only D in fitting(not E) def.skip_pole=0</div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_8b2c91a1122d1f1764fea2c97c31c88b.html">Matlab</a></li><li class="navelem"><a class="el" href="_q_ppassive_8m.html">QPpassive.m</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
